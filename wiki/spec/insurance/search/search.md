# 查詢 - 查詢

## 功能
* 依使用者提供之條件可查詢保單詳細資料
* 提供保/表單 PDF 下載預覽
* 提供保/表單在本系統之紀錄查詢
* 可匯出當前查詢結果之 csv 檔

## 鎖定規則

| 項目     | 說明                                                                                   |
| -------- | -------------------------------------------------------------------------------------- |
| 查詢按鈕 | 需選擇或輸入任一條件, 否則鎖定 <br> 若未選擇批次日期, 將只查詢90天內資料               |
| PDF      | 未轉檔將鎖定 `progress === 'RC'` <br> 超過7天, 後端 flag `PDF_REMOVED === true` 將鎖定 |

## 查詢條件、欄位名稱與延伸資訊
| 項目                | API Parameters                | 說明                                                                                 |
| ------------------- | ----------------------------- | ------------------------------------------------------------------------------------ |
| 保單/表單號碼       | name                          | 表單: 一些例行性資料，像是每月季報                                                   |
| 批次日期            | cycle_date                    | 自動化抓取(台壽)xml、(遠雄)csv資料的時間                                             |
| 業務來源 (台壽)     | billing_category              | 該保/表單所屬的一級單位業務部門                                                      |
| 發單類別 (遠雄)     | billing_category              | 該保/表單所屬的一級單位業務部門                                                      |
| 業務關聯代碼 (台壽) | unit_id                       | 該保/表單所屬的二級單位業務部門                                                      |
| 單位識別碼 (遠雄)   | unit_id                       | 該保單之所屬單位識別碼                                                               |
| 通路                | channel                       | 該客戶由哪個通路投保的                                                               |
| 狀態                | status                        | N: 正常 R: 退件(未列印成實體/非電子檔) CR: 驗退 P: 抽件                              |
| 批次類型            | cycle_type                    | B: 正常 O: 急件                                                                      |
| 險種代碼            | type_code                     | 財產保險各險種之代碼                                                                 |
| 郵寄方式            | posting_service               | 將保/表單寄送到客戶手上的方式 <br> 1: 平信 2: 掛號 3: 雙掛號 4: 快遞                 |
| 契約始期            | effective_date                | 該客戶與保險公司購買保險之契約初始日期                                               |
| 郵寄日期            | mail_date                     | 該保/表單送出郵寄之日期                                                              |
| 工單編號            | order_id                      | 遠雄: 自動化抓取資料時, 依檔名分類相同模組歸為同一工單 <br> 台壽: 依xml 檔分為一工單 |
| 委外公司            | outsourcing_id                | 該保單之委外列印公司                                                                 |
| 寄送類型            | mail_type                     | 該保單寄出之寄送日期                                                                 |
| 有無變更地址        | flag.recipient_address_update | 被 flag 標記變更地址的保單(驗退、抽件、變更地址)                                     |
| 要保人              | policy_owner_name             | 該保單之要保人                                                                       |
| 被保人              | insured_name                  | 該保單之被保人                                                                       |
| 進度                | progress                      | RC: 已接收 CO: 已轉檔 PR: 已列印 BD: 已膠裝 CK: 已檢驗 PA: 已裝封 PO: 已交寄         |
| 海卡                | Haika                         | 海外服務卡，作業時決定是否夾寄。                                                     |
| 歸戶碼              | package_code                  | 相同地址之保單將歸為同一戶並賦予一個代碼                                             |
| 收件人              | recipient                     | 該保/表單之收件人名稱                                                                |
| 收件人地址          | recipient_address             | 該保/表單之收件人地址                                                                |
| 經手人名稱          | agt_name                      | 該保/表單之業務經手人                                                                |
| 單位名稱            | unit_name                     | 該保/表單之所屬單位名稱                                                              |
| 收件職場            | in_factory                    | 用於傳遞清單                                                                         |
| 掛號單碼            | register_number               | 如該保單需掛號則會有掛號單碼提供貨運司機核對(已交寄才顯示)                           |
| 備註                | remarks                       | 通常紀錄該保單被操作之原因, 如抽件原因                                               |

## 動作
| 項目 | 說明                     |
| ---- | ------------------------ |
| 查詢 | 可查詢該保單之被操作紀錄 |
| PDF | 可查詢該保單之PDF 影像檔  |

## 業務邏輯
* 7個工作天後屏蔽個資(後端屏蔽)
    * 要保人
    * 被保人
    * 收件人
    * 收件地址